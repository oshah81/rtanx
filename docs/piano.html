<!doctype html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Player Piano</title>
	<link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
	<link rel="preload" href="site.css" as="style" />
	<link rel="preload" href="source-sans-pro-v14-latin-regular.woff2" as="font" crossorigin="anonymous" />
	<link rel="preload" href="piano-player.css" as="style" />
	<link rel="preload" href="script-helpers.js" as="script" crossorigin="anonymous" />
	<link rel="preload" href="piano-player.js" as="script" crossorigin="anonymous" />
	<link rel="preload" href="config-manager.js" as="script" crossorigin="anonymous" />
	
	<link rel="preload" href="piano.json" as="fetch" crossorigin="anonymous" />

	<link rel="stylesheet" href="site.css" type="text/css" />
	<script type="module">
		import ConfigManager from "./config-manager.js";
		globalThis.pageConfig = new ConfigManager();
		globalThis.eventLog = globalThis.pageConfig.setup.eventLog;
	</script>
</head>
<body>
	<div class="container">
		<header>
			<aside class="settingsBar">
				<label>Volume:
					<input type="range" min="0.0" max="1.0" step="0.01" value="0.5" list="volumesDrop" name="volume" />
				</label>
			</aside>
		</header>
		
		<main>
			<section class="page-1">
				<h1>Parkinsons trial</h1>
			</section>
			<section class="page-2" hidden="hidden">
				<piano-player notes="kgjh" pace="0.5" volumecontrol="0.5"></piano-player>
				<p>Place the index, middle, ring, little fingers of your right hand on keyboard keys g-h-j-k. Warm up by pressing the keys up and down in any order, but not simultaneously. Pay attention to the little finger, it should also comfortably press the corresponding key (k). Make sure you hear the tone of each key, at a comfortable sound level. Adjust the volume if you don’t hear the tones.</p>
				<p>Now you are going to practice sequence 1, represented by this image:</p>
				<img src="fractal1.png" alt="Pink button" style="width: 200px; height: 200px;" />
			</section>
			<section class="page-3" hidden="hidden">
				<p>Sequence 1 consists of four key presses, in this order:</p>
				<p>g – j – h – k</p>
				<p>(that is, index – ring – middle – little finger)</p>
				<p>Press enter to continue</p>
				<img src="fractal1.png" alt="Pink button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-4" hidden="hidden">
				<piano-player notes="gjhk" pace="0.5" volumecontrol="0.5"></piano-player>
				<p>Sequence 1 consists of four key presses, in this order:</p>
				<p>g – j – h – k</p>
				<p>(that is, index – ring – middle – little finger)</p>
				<p>Try it out at a comfortable speed, you can practice it slowly now, to make sure the order is clear.</p>
				<p>Take a little break of 1-2 seconds between each performance of the sequence. You can practice it up to 10 times.</p>
				<span id="steppedGame">Press F1 to have the computer remind you of the sequence</span>
				<img src="fractal1.png" alt="Pink button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-5" hidden="hidden">
				<p>Was it enough practice? Can you remember the sequence?</p>
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<p>Press enter to continue</p>
				<img src="fractal1.png" alt="Pink button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-6" hidden="hidden">
				<piano-player notes="gjhk" pace="0.5" volumecontrol="0.5"></piano-player>
				<p class="statusLbl">Try it out! Play it once at a time and wait for the computer to tell you whether it is correct.</p>
				<p>Hint: It starts with the right index pressing keyboard letter g.</p>
				<img src="fractal1.png" alt="Pink button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-7" hidden="hidden">
				<p>Now you are going to practice sequence 2, represented by this image:</p>
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<p>Press enter to continue</p>
				<img src="fractal2.png" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-8" hidden="hidden">
				<p>Sequence 2 consists of four key presses, in this order:</p>
				<p>k – g – j – h</p>
				<p>(that is, little - index – ring – middle finger)</p>
				<p>Press enter to continue</p>
				<img src="fractal2.png" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-9" hidden="hidden">
				<piano-player notes="kgjh" pace="0.5" volumecontrol="0.5"></piano-player>
				<p>Sequence 2 consists of four key presses, in this order:</p>
				<p>k – g – j – h</p>
				<p>(that is, little - index – ring – middle finger)</p>
				<p>Try it out at a comfortable speed, you can practice it slowly now, to make sure the order is clear.</p>
				<p>Take a little break of 1-2 seconds between each performance of the sequence. You can practice it up to 10 times.</p>
				<span id="steppedGame">Press F1 to have the computer remind you of the sequence</span>
				<img src="fractal2.png" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-10" hidden="hidden">
				<p>Was it enough practice? Can you remember the sequence?</p>
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<p>Press enter to continue</p>
				<img src="fractal2.png" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-11" hidden="hidden">
				<piano-player notes="kgjh" pace="0.5" volumecontrol="0.5"></piano-player>
				<p class="statusLbl">Try it out! Play it once at a time and wait for the computer to tell you whether it is correct.</p>
				<p>Hint: It starts with the right index pressing keyboard letter g.</p>
				<img src="fractal2.png" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-12" hidden="hidden">
				<p>Now you will see the images representing sequence 1 and sequence 2 on the screen.
				Each time you see both, you have to decide whether you play sequence 1 or sequence 2.</p>
				<div class="image-position">
					<img src="fractal1.png" class="clickable" alt="Pink button" style="width: 200px; height: 200px;" data-page="1" />
					<img src="fractal2.png" class="clickable" alt="Yellow button" style="width: 200px; height: 200px;" data-page="2" />
				</div>
				<p>Then you will simply play the sequence you choose on that attempt. Once you play the sequence, you will see whether you
				obtain reward (5 points) or not. Your aim is to obtain as many points as possible at the end of this study, so play the
				sequence you think will more likely give you reward! Careful though: The reward (points) associated with each sequence
				will change from time to time. So pay attention and adapt your decisions if you think that the conditions changed.</p>
				<p>Press 1 (or click the purple icon) to choose sequence 1.<p>
				<p>Press 2 (or click the yellow icon) to choose sequence 2.</p>
			</section>

			<section class="page-13" hidden="hidden">
				<piano-player notes="kgjh" pace="1.0" volumecontrol="0.5"></piano-player>
				<p class="statusLbl">Play sequence.</p>
				<img src="fractal2.png" class="active-icon" alt="Yellow button" style="width: 200px; height: 200px;" />
			</section>

			<section class="page-14" hidden="hidden">
				<h2 class="statusLbl incorrect-msg">Wrong Sequence. You don't get the points</h2>
			</section>

			<section class="page-15" hidden="hidden">
				<h2 class="statusLbl correct-msg">That was the correct sequence. You get 1 points.</h2>
			</section>
		</main>
		<footer>
			<button id="nextButton" onclick="globalThis.onNextPage(event)">Next &gt;</button>
		</footer>
	</div>
	<datalist id="volumesDrop">
		<option value="0.0" label="Mute">
		<option value="1.0" label="100%">
	</datalist>
	<div id="splash" hidden="hidden">6</div>

	<script type="module">
		import { setupVolumeControl, setupIcons, keyUpManager, keyDownManager } from "./script-helpers.js";

		setupVolumeControl();
		setupIcons();
		document.addEventListener("keydown", async evt => await keyDownManager(evt));
		document.addEventListener("keyup", async evt => await keyUpManager(evt, evt.key));

		globalThis.onNextPage = async event => {
			let round = globalThis.pageConfig.setup.round;
			if (round === 14) {
				document.querySelector(".page-14").hidden = true;
				document.querySelector(".page-15").hidden = true;
				round = 12;
			} else if (round === 15) {
				document.querySelector(".page-14").hidden = true;
				document.querySelector(".page-15").hidden = true;
				round = 12;
			} else {
				round++;
			}
			globalThis.pageConfig.setup.round = round;
			eventLog.push({ type: "startNextRound", time: performance.now(), round: round });

			document.querySelector(".page-" + parseInt(round-1)).hidden = true;
			document.querySelector(".page-" + parseInt(round)).hidden = false;
			
			if (round === 4) {
				const activePiano = document.querySelector("section.page-4 piano-player");
				await activePiano.playNextRound();
			} else if (round === 6) {
				document.getElementById("nextButton").disabled = true;
			} else if (round == 7) {
				document.getElementById("nextButton").disabled = false;
			} else if (round === 9) {
				const activePiano = document.querySelector("section.page-9 piano-player");
				await activePiano.playNextRound();
			} else if (round === 11) {
				document.getElementById("nextButton").disabled = true;
			} else if (round === 12) {
				document.getElementById("nextButton").hidden = true;
				document.getElementById("nextButton").disabled = true;
				handleRound12();
			} else if (round === 13) {
				document.getElementById("nextButton").hidden = true;
				document.getElementById("nextButton").disabled = true;
			} else if (round === 14 || round === 14) {
				document.getElementById("nextButton").hidden = false;
				document.getElementById("nextButton").disabled = false;
			}
		};

		function handleRound12() {
		}

	</script>
	<script type="module">
		import PianoPlayerElement from "./piano-player.js";

		customElements.define("piano-player", PianoPlayerElement);
	</script>
</body>
</html>
